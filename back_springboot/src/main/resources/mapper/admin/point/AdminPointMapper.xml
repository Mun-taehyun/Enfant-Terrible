<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.enfantTerrible.enfantTerrible.mapper.admin.point.AdminPointMapper">

  <select id="findHistory" resultType="com.enfantTerrible.enfantTerrible.dto.admin.point.AdminPointHistoryResponse">
    SELECT
      point_history_id,
      user_id,
      point_amount,
      point_type,
      reason,
      ref_type,
      ref_id,
      created_at
    FROM et_point_history
    WHERE user_id = #{userId}
    ORDER BY
    <choose>
      <when test="req.sortBy == 'CREATED_AT'">created_at</when>
      <otherwise>point_history_id</otherwise>
    </choose>
    <choose>
      <when test="req.direction == 'ASC'">ASC</when>
      <otherwise>DESC</otherwise>
    </choose>
    LIMIT #{req.size} OFFSET #{req.offset}
  </select>

  <select id="countHistory" resultType="int">
    SELECT COUNT(*)
    FROM et_point_history
    WHERE user_id = #{userId}
  </select>

</mapper>
