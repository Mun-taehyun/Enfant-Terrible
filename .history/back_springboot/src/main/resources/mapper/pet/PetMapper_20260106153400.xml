<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.enfantTerrible.enfantTerrible.mapper.pet.PetMapper">

  <!-- 펫 등록 -->
  <insert id="insert" useGeneratedKeys="true" keyProperty="petId">
    INSERT INTO et_pet (
      user_id,
      name,
      species,
      breed,
      age,
      gender,
      is_neutered,
      activity_level,
      weight
    ) VALUES (
      #{userId},
      #{name, jdbcType=VARCHAR},
      #{species, jdbcType=VARCHAR},
      #{breed, jdbcType=VARCHAR},
      #{age, jdbcType=INTEGER},
      #{gender, jdbcType=VARCHAR},
      #{isNeutered, jdbcType=TINYINT},
      #{activityLevel, jdbcType=TINYINT},
      #{weight, jdbcType=FLOAT}
    )
  </insert>

  <!-- 내 펫 목록 조회 -->
  <select id="findByUserId" resultType="PetRow">
    SELECT *
    FROM et_pet
    WHERE user_id = #{userId}
      AND deleted_at IS NULL
    ORDER BY pet_id DESC
  </select>

  <!-- 펫 단건 조회 -->
  <select id="findById" resultType="PetRow">
    SELECT *
    FROM et_pet
    WHERE pet_id = #{petId}
      AND deleted_at IS NULL
  </select>

  <!-- 펫 정보 수정 -->
  <update id="update">
    UPDATE et_pet
    SET
      name = #{name, jdbcType=VARCHAR},
      species = #{species, jdbcType=VARCHAR},
      breed = #{breed, jdbcType=VARCHAR},
      age = #{age, jdbcType=INTEGER},
      gender = #{gender, jdbcType=VARCHAR},
      is_neutered = #{isNeutered, jdbcType=TINYINT},
      activity_level = #{activityLevel, jdbcType=TINYINT},
      weight = #{weight, jdbcType=FLOAT}
    WHERE pet_id = #{petId}
      AND deleted_at IS NULL
  </update>

  <!-- 펫 소프트 삭제 -->
  <update id="softDelete">
    UPDATE et_pet
    SET
      deleted_at = NOW()
    WHERE pet_id = #{petId}
      AND deleted_at IS NULL
  </update>

</mapper>
