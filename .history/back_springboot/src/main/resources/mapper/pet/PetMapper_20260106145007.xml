<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.enfantTerrible.enfantTerrible.pet.mapper.PetMapper">

  <!-- 펫 등록 -->
  <insert id="insertPet">
    INSERT INTO et_pet (
      user_id,
      name,
      species,
      breed,
      age,
      gender,
      is_neutered,
      activity_level,
      weight
    ) VALUES (
      #{userId},
      #{req.name},
      #{req.species},
      #{req.breed},
      #{req.age},
      #{req.gender},
      #{req.isNeutered},
      #{req.activityLevel},
      #{req.weight}
    )
  </insert>

  <!-- 내 펫 목록 조회 -->
  <select id="findByUserId" resultType="PetResponse">
    SELECT
      pet_id,
      name,
      species,
      breed,
      age,
      gender,
      is_neutered,
      activity_level,
      weight
    FROM et_pet
    WHERE user_id = #{userId}
      AND deleted_at IS NULL
    ORDER BY pet_id DESC
  </select>

  <!-- 펫 단건 조회 -->
  <select id="findById" resultType="PetResponse">
    SELECT
      pet_id,
      name,
      species,
      breed,
      age,
      gender,
      is_neutered,
      activity_level,
      weight
    FROM et_pet
    WHERE pet_id = #{petId}
      AND deleted_at IS NULL
  </select>

  <!-- 펫 정보 수정 -->
  <update id="updatePet">
    UPDATE et_pet
    SET
      name = #{req.name},
      species = #{req.species},
      breed = #{req.breed},
      age = #{req.age},
      gender = #{req.gender},
      is_neutered = #{req.isNeutered},
      activity_level = #{req.activityLevel},
      weight = #{req.weight},
      updated_at = NOW()
    WHERE pet_id = #{petId}
      AND deleted_at IS NULL
  </update>

  <!-- 펫 소프트 삭제 -->
  <update id="softDelete">
    UPDATE et_pet
    SET deleted_at = NOW()
    WHERE pet_id = #{petId}
      AND deleted_at IS NULL
  </update>

</mapper>
